<!DOCTYPE html>
<html>
<head>
    <title>Date Recorder</title>
    <script>
        async function recordDate() {
            const now = new Date();
            const targetDate = new Date('2024-01-01T00:00:00');
            
            if (now <= targetDate) {
                console.log('목표 날짜에 도달했습니다.');
                return;
            }

            // 현재 날짜를 YYYY-MM-DD HH:mm:ss 형식으로 포맷
            const formattedDate = now.toISOString().replace('T', ' ').slice(0, 19);
            
            try {
                // memo.txt에 날짜 추가
                const response = await fetch('memo.txt', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'text/plain',
                    },
                    body: formattedDate + '\n\n'
                });

                if (!response.ok) {
                    throw new Error('Failed to write to memo.txt');
                }

                // Git 명령어 실행
                const gitCommands = [
                    'git add .',
                    `git commit -m "memo.txt 업데이트: ${formattedDate}"`,
                    'git push origin master'
                ];

                for (const cmd of gitCommands) {
                    const result = await executeCommand(cmd);
                    console.log(`Executed: ${cmd}`);
                    console.log(result);
                }

                // 다음 날로 설정
                now.setDate(now.getDate() - 1);
                
                // 1초 후 다시 실행
                setTimeout(recordDate, 1000);
            } catch (error) {
                console.error('Error:', error);
            }
        }

        async function executeCommand(command) {
            try {
                const response = await fetch('/execute', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ command })
                });
                return await response.text();
            } catch (error) {
                console.error('Command execution error:', error);
                return 'Error executing command';
            }
        }

        // 페이지 로드 시 시작
        window.onload = recordDate;
    </script>
</head>
<body>
    <h1>Date Recorder</h1>
    <p>현재 날짜부터 2024년 1월 1일까지 기록 중...</p>
    <div id="status"></div>
</body>
</html>
